

## Pinia

> Pinia，是一个 Vue 阵营的最新的状态管理库。（vue官网推荐使用Pinia来代替vuex）



## 基本介绍

> Pinia 是一个西班牙语的单词，表示“菠萝”的意思。因为菠萝是由一小块一小块组成的，这个和 Pinia 的思想非常吻合。在 Pinia 中，**每个 Store 仓库都是单独且扁平化存在的**。
>
> 
>
> Pinia 的 **API 更少而且更简单**，**还支持组合式 API**，**还可以和TS一起使用来做类型的推断**。

- 每个Store都是独立且扁平化存在的。
- API更少且简单。
- 支持Composition API。
- 支持TS。



## Pinia优势

1. 在 Pinia 中，已经不存在 `mutations`，只有 `state`、`getters`、`actions`。

   ```js
   import { defineStore } from 'pinia'
   
   export const useCounterStore = defineStore('counter', {
      state: () => ({
          count: 0
      }),
      getters: {
          // 计算属性
          doubleCount: (state) => state.count * 2,
      },
       actions: {
           // 同步行为
           increment(){
               this.count++;
           },
           
           // 异步行为
           async asyncIncrement(){
               await new Promise(resolve => setTimeout(resolve, 1000));
               this.increment();
           }
       }
   });
   ```

   - 使用`pinia`中的`defineStore`函数，创建了一个Store。
   - `state`函数的返回值、`getters`对象中成员、`actions`对象中方法，会注入到仓库实例中。
   - `actions`中既可以进行同步行为，也可以进行异步行为，方法内`this`指向仓库实例。

2. 支持 TypeScript。

3. 每个Store都是独立且扁平化的存在，不像vuex是通过 `modules`嵌套的。

4. 支持插件（函数）扩展，为仓库添加全局属性货方法。（插件本质就是一个函数）

   ```js
   const localStoragePlugin = (context) => {
       const key = 'my-app-state';
       
       // 从localStorage恢复状态
       context.state = localStorage.getItem(key) || context.state;
       
       // 监听 state 变化，将变化保存到 localStorage
       context.subscribe((mutation) => {
          localStorage.setItem(key, context.state); 
       });
       
   };
   
   // 创建 Pinia 实例，并注册 localStorage 插件
   import { createPinia } from 'pinia';
   const pinia = createPinia();
   pinia.use(localStoragePlugin);
   ```

   

5. 更加轻量，压缩之后体积只有 `1kb` 左右。



































